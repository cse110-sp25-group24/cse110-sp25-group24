<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: map.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: map.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { getAllLocations, initDB } from "./dataHandlingFunctions.js";
// Implement Base Map Issue #32

/*---------Global Variables---------*/

/**
 * Holds the initialized Google Maps map instance.
 * @type {google.maps.Map|null}
 */
let map = null;

/**
 * The key used for storing/retrieving the Google Maps API key from localStorage.
 * @type {string}
 */
const API_KEY_STORAGE = "googleMapsApiKLey";
let db = null;

/*---------General Google Maps API functions---------*/

/**
 * Dynamically loads the Google Maps JavaScript API.
 *
 * @param {string} apiKey - The user's Google Maps API key.
 * @param {string} [lib=""] - Optional Google Maps libraries to include (e.g., "marker").
 * @param {boolean} [removeInput=true] - Whether to remove the API key input elements after loading.
 * @returns {Promise&lt;void>} Resolves when the API is loaded successfully; rejects if it fails.
 */
export function loadGoogleMaps(apiKey, lib = "", removeInput = true) {
  return new Promise((resolve, reject) => {
    let script = document.createElement("script");
    script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&amp;libraries=${lib}`;
    script.async = true;
    script.defer = true;

    script.onload = () => {
      resolve();
    };

    script.onerror = () => {
      reject(new Error("Failed to load Google Maps API"));
    };

    if (removeInput) {
      document.head.appendChild(script);
      document.getElementById("apiKeyInput").remove();
      document.getElementById("apiKeyPrompt").remove();
      document.getElementById("loadMapBtn").remove();
      document.getElementById("api-key-box").remove();
      // document.getElementByClassName("api-key-box").remove()
    }
  });
}

/**
 * Handles user input of the API key and starts loading the map.
 * Validates input, stores the key, loads the map, and populates it with markers.
 */
export function insertAPIKey() {
  const apiKey = document.getElementById("apiKeyInput").value.trim();
  if (!apiKey) {
    alert("Please enter a valid API key.");
    return;
  }

  localStorage.setItem(API_KEY_STORAGE, apiKey);

  loadGoogleMaps(apiKey, "marker").then(() => {
    initMap();
    populateMap(map, db);
    // window.location.href = "index.html";
  });
}

/*---------------Map Specific Functions---------------*/

/**
 * Initializes the map display by opening the IndexedDB database and rendering saved locations.
 * Also loads the Google Maps API if an API key is stored.
 *
 * @async
 * @function
 * @returns {Promise&lt;void>} Resolves when the map is ready.
 */
export async function initMapDisplay() {
  return new Promise(async (resolve, reject) => {
    db = await initDB();
    const savedApiKey = localStorage.getItem(API_KEY_STORAGE);
    try {
      if (savedApiKey) {
        loadGoogleMaps(savedApiKey, "marker").then(() => {
          initMap();
          populateMap(map, db);
        });
      }
    } catch (err) {
      reject(err);
    }
  });
}

/**
 * Callback function for Google Maps API to initialize the map.
 * Sets up the map centered on San Diego with some controls disabled.
 * Also adds a marker at the center point.
 *
 */
function initMap() {
  map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: 32.8802, lng: -117.2392 }, // San Diego
    zoom: 10,
    mapTypeControl: false,
    streetViewControl: false,
    fullscreenControl: false,
    mapId: "f47c32b1338834821e79fe83",
  });
}

function populateMap(map, db) {
  getAllLocations(db).then((coords) => {
    // coords list from the memories stored in db
    for (let marker of coords) {
      const [lat, long, title] = marker;
      addMarker(map, lat, long, title);
    }
  });
}

/**
 * Adds a marker to the specified map at given latitude and longitude.
 * @param {google.maps.Map} map - The map instance to add the marker to.
 * @param {number} lat - Latitude coordinate for the marker.
 * @param {number} lng - Longitude coordinate for the marker.
 * @param {string} [title=""] - Optional title text for the marker tooltip.
 */
function addMarker(map, lat, lng, title = "") {
  // let marker = new google.maps.Marker({
  //   // legacy code
  //   position: new google.maps.LatLng(lat, lng),
  //   map: map,
  //   title: title,
  // });

  // placing marker

  // to-do: add marker interactivity if possible
  const marker = new google.maps.marker.AdvancedMarkerElement({
    map: map,
    position: { lat, lng },
  });
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#API_KEY_STORAGE">API_KEY_STORAGE</a></li><li><a href="global.html#addMarker">addMarker</a></li><li><a href="global.html#addMemory">addMemory</a></li><li><a href="global.html#cardTemplate">cardTemplate</a></li><li><a href="global.html#changeImg">changeImg</a></li><li><a href="global.html#confirmSafety">confirmSafety</a></li><li><a href="global.html#createCardContent">createCardContent</a></li><li><a href="global.html#createCardMeta">createCardMeta</a></li><li><a href="global.html#createMemoryPhoto">createMemoryPhoto</a></li><li><a href="global.html#deleteAllMemories">deleteAllMemories</a></li><li><a href="global.html#deleteListener">deleteListener</a></li><li><a href="global.html#deleteMemory">deleteMemory</a></li><li><a href="global.html#displayAllMemories">displayAllMemories</a></li><li><a href="global.html#editListener">editListener</a></li><li><a href="global.html#fileToDataUrl">fileToDataUrl</a></li><li><a href="global.html#fillForm">fillForm</a></li><li><a href="global.html#getAllLocations">getAllLocations</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#initAutocomplete">initAutocomplete</a></li><li><a href="global.html#initCreate">initCreate</a></li><li><a href="global.html#initDB">initDB</a></li><li><a href="global.html#initMap">initMap</a></li><li><a href="global.html#initMapDisplay">initMapDisplay</a></li><li><a href="global.html#insertAPIKey">insertAPIKey</a></li><li><a href="global.html#isEmptyDB">isEmptyDB</a></li><li><a href="global.html#loadGoogleMaps">loadGoogleMaps</a></li><li><a href="global.html#map">map</a></li><li><a href="global.html#onPlaceChanged">onPlaceChanged</a></li><li><a href="global.html#retrieveMemory">retrieveMemory</a></li><li><a href="global.html#submitForm">submitForm</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Wed Jun 11 2025 02:09:43 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
