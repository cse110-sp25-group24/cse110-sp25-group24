---
title: [Card ADR] - [Decide on specifics for how to view/store/retrieve cards]
status: Proposed
date: 05-10-2025
decision-makers: [Chris Enotiadis, Eric Song, Phiroze Duggal]
---

## Summary

Our goal is to implement location cards on the map using dual view (being able to see cards both on the map and in list format), using IndexedDB in order to achieve efficient data retrieval, as well as geospatial caching, and consistency in the components of each card.

## Context and Problem Statement

Our appliation must be able to display the location cards in both formats. The styling and format of these cards must be the same, and the users need to be able to transition betwen the map and list view smoothly. In this ADR, we must determine:

- How cards will be represented in the DB
- How card information will be retrieved
- How users will interact with/create cards
- How to implement the dual view described above.

## Considered Options

### Database

- IndexedDB (decided already)

### Data Retrieval Methods

- Loads cards currently visible on map
- As well as that, preload (fetch) nearby areas <--
- Load everything

### Card Interaction

- Expandable Preview Image - Expands to full card, preview appears on map/list
- Dots showing card locations, expandable (no preview)
- Dot showing, picture preview shows on hover

### Mode Switching

- Toggle switch between list of cards and map view
- Split view
- Separate tabs for each
- Split view, option to toggle

## Decision Outcome

### Database

- IndexedDB (decided already)? (TEAM OPINION: FURTHER DISCUSSION IS NEEDED FOR THIS)
- See Storage ADR for database example

### Data Retrieval Methods

- Load currently visible cards, as well as fetching nearby areas.

### Example

Example code utilized AI Support

```js
// Data retrieval pseudocode
const fetchLocationCards = async (viewportBounds, options = {}) => {
  // Expand bounds to include prefetch area
  const expandedBounds = expandBounds(viewportBounds, 0.5); // 50% expansion (example)

  // Check cache first
  const cachedCards = await getCardsFromCache(expandedBounds);

  if (isCacheComplete(expandedBounds) && !isCacheStale()) {
    return filterCards(cachedCards, options);
  }

  // Fetch from server for missing areas
  const missingAreas = calculateMissingAreas(expandedBounds, cachedCards);

  if (missingAreas.length > 0) {
    const newCards = await fetchCardsFromServer(missingAreas, options);
    await addCardsToCache(newCards);

    return filterCards([...cachedCards, ...newCards], options);
  }

  return filterCards(cachedCards, options);
};
```

### Card Interaction

- Dot showing, picture preview shows on hover

#### Example

Example code utilized AI Support

```js
// Card interaction pseudocode
const MapView = ({ cards, onSelectCard }) => {
  const [hoveredCardId, setHoveredCardId] = useState(null);

  return (
    <div className="map-container">
      <Map>
        {cards.map((card) => (
          <React.Fragment key={card.id}>
            {/* Location dot */}
            <Marker
              position={card.location.coordinates}
              onMouseEnter={() => setHoveredCardId(card.id)}
              onMouseLeave={() => setHoveredCardId(null)}
              onClick={() => onSelectCard(card)}
            />

            {/* Hover preview */}
            {hoveredCardId === card.id && (
              <CardPreview position={card.location.coordinates} card={card} />
            )}
          </React.Fragment>
        ))}
      </Map>
    </div>
  );
};

const CardPreview = ({ card }) => (
  <div className="card-preview">
    <img src={card.thumbnailImage} alt={card.name} />
    <h3>{card.name}</h3>
    <div className="card-category">{card.category}</div>
    <div className="card-rating">â˜… {card.rating}</div>
  </div>
);
```

### Mode Switching

- Split view, option to toggle

## Consequences

### Positive

- IndexedDB provides offline access to cards
  - would have to adjust the code to make the whole thing fully offline
- Prefetching close areas allows for a smoother experience, less waiting time
- Dot hover format allows for an uncluttered map and straightforward UI, without sacrificing any important tradeoffs.
- Split View with toggle - allows users to customize UI to their liking, default split view allows a 'recent memories' style page

### Negative

- IndexedDB might not work with multi-user design
- Prefetching more sophisticated spatial indexing - more complex code as well
- Hover doesn't translate well to mobile devices - might need different style for Desktop V. Mobile
- Split View might be a bit cluttered, also might be difficult to implement on different screen sizes.
- Additionally, maintaining multiple views increases complexity.

### Confirmation

- Confirm if we will use IndexedDB or something else, after team discussion
- Verify how we will implement prefetch
- Test hover interaction, figure out solution for mobile
- Ensure split looks appealing, and works on different devices/screen sizes
- Ensure that none of this affects how the cards appear

## Other Examples

### Card Layouts

```json
{
    post_id: ""
    user_id : "",
    date: "",
    description: "",
    emotion_tag: "",
    latitude: "", // using lat/long to generate point on map?
    longtitude: "",
    photo_path: ""
}
```

### Example of Table(s)

[table example](dataStructuresFlowChart.png)
